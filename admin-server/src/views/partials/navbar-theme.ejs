<!-- views/partials/topnav.ejs (or inline in your page) -->
<nav class="navbar-wrapper">
  <!-- SEARCH -->
  <form class="navbar-search" onsubmit="return false;">
    <button type="submit" class="navbar-search__btn" aria-label="Search">
      <i class="las la-search"></i>
    </button>
    <input
      type="search"
      name="navbar-search__field"
      id="navbar-search__field"
      placeholder="Searchâ€¦"
      autocomplete="off"
    />
    <button
      type="button"
      class="navbar-search__close"
      aria-label="Close search"
    >
      <i class="las la-times"></i>
    </button>
    <div id="navbar_search_result_area" role="listbox">
      <ul class="navbar_search_result"></ul>
    </div>
  </form>

  <!-- LEFT -->
  <div class="navbar__left">
    <button class="res-sidebar-open-btn" aria-label="Open sidebar">
      <i class="las la-bars"></i>
    </button>

    <button type="button" class="fullscreen-btn" aria-label="Toggle fullscreen">
      <i class="fullscreen-open las la-expand"></i>
      <i class="fullscreen-close las la-compress-arrows-alt"></i>
    </button>
  </div>

  <!-- RIGHT -->
  <div class="navbar__right">
    <ul class="navbar__action-list">
      <li>
        <button
          type="button"
          class="navbar-search__btn-open"
          aria-label="Open search"
        >
          <i class="las la-search"></i>
        </button>
      </li>

      <li class="dropdown">
        <button
          type="button"
          class="dropdown__toggle"
          aria-haspopup="true"
          aria-expanded="false"
        >
          <span class="navbar-user">
            <span class="navbar-user__thumb">
              <img
                src="https://allcoinstakes.com/assets/admin/images/profile/64b3b2d4d63011689498324.jpg"
                alt="avatar"
              />
            </span>
            <span class="navbar-user__info">
              <span class="navbar-user__name"
                ><%= (user && user.email) || 'admin' %></span
              >
            </span>
            <span class="icon"><i class="las la-chevron-circle-down"></i></span>
          </span>
        </button>

        <!-- SECURE LOGOUT: use POST with CSRF -->
        <div class="dropdown-menu dropdown-menu--sm" role="menu">
          <form method="post" action="/admin/logout">
            <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
            <% } %>
            <button class="dropdown-menu__item" type="submit">
              <i class="dropdown-menu__icon las la-sign-out-alt"></i>
              <span class="dropdown-menu__caption">Logout</span>
            </button>
          </form>
        </div>
      </li>
    </ul>
  </div>
</nav>

<style>
  :root {
    --nav-bg: #0f0f12; /* black */
    --nav-text: #f7f7f8; /* white-ish */
    --nav-muted: #b7bac2;
    --nav-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
    --accent: #c26a1f; /* brownish orange */
    --accent-2: #e18a3a; /* lighter brownish orange */
    --chip-bg: #1a1b20;
    --ring: 0 0 0 2px rgba(226, 149, 66, 0.35);
    --radius: 14px;
  }

  .navbar-wrapper {
    position: sticky;
    top: 0;
    z-index: 1100;
    display: grid;
    grid-template-columns: 1fr auto auto;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    background: linear-gradient(
        180deg,
        rgba(194, 106, 31, 0.06),
        rgba(194, 106, 31, 0)
      ),
      var(--nav-bg);
    color: var(--nav-text);
    box-shadow: var(--nav-shadow);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  }

  /* SEARCH (inline on desktop, modal-ish on mobile) */
  .navbar-search {
    position: relative;
    display: flex;
    align-items: center;
    gap: 8px;
    background: #131419;
    border: 1px solid #23242c;
    border-radius: var(--radius);
    padding: 8px 10px;
    min-width: 360px;
  }
  .navbar-search:focus-within {
    box-shadow: var(--ring);
    border-color: #343541;
  }
  .navbar-search__btn,
  .navbar-search__close {
    background: transparent;
    border: 0;
    color: var(--nav-muted);
    font-size: 18px;
    line-height: 1;
    padding: 4px 6px;
    border-radius: 8px;
    cursor: pointer;
  }
  .navbar-search__btn:hover,
  .navbar-search__close:hover {
    color: var(--accent-2);
    background: rgba(255, 255, 255, 0.06);
  }
  #navbar-search__field {
    flex: 1;
    background: transparent;
    border: 0;
    color: var(--nav-text);
    font-size: 14px;
    outline: none;
  }
  #navbar_search_result_area {
    position: absolute;
    left: 0;
    top: calc(100% + 6px);
    width: 100%;
    background: #121319;
    border: 1px solid #23242c;
    border-radius: 10px;
    box-shadow: var(--nav-shadow);
    display: none;
    max-height: 320px;
    overflow: auto;
  }
  .navbar_search_result {
    list-style: none;
    margin: 0;
    padding: 6px;
  }
  .navbar_search_result li {
    padding: 8px 10px;
    border-radius: 8px;
    color: var(--nav-text);
  }
  .navbar_search_result li:hover {
    background: rgba(255, 255, 255, 0.06);
  }

  /* LEFT ICONS */
  .navbar__left,
  .navbar__right {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .res-sidebar-open-btn,
  .fullscreen-btn,
  .navbar-search__btn-open,
  .dropdown__toggle {
    background: #15161b;
    color: var(--nav-text);
    border: 1px solid #2a2b34;
    border-radius: 12px;
    padding: 8px 10px;
    font-size: 18px;
    cursor: pointer;
  }
  .res-sidebar-open-btn:hover,
  .fullscreen-btn:hover,
  .navbar-search__btn-open:hover,
  .dropdown__toggle:hover {
    border-color: var(--accent);
    box-shadow: var(--ring);
  }

  .fullscreen-btn .fullscreen-close {
    display: none;
  }
  body.is-fullscreen .fullscreen-btn .fullscreen-open {
    display: none;
  }
  body.is-fullscreen .fullscreen-btn .fullscreen-close {
    display: inline-block;
  }

  /* RIGHT SIDE */
  .navbar__action-list {
    display: flex;
    align-items: center;
    gap: 10px;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  /* USER */
  .navbar-user {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .navbar-user__thumb img {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid #2a2b34;
  }
  .navbar-user__name {
    font-weight: 700;
    letter-spacing: 0.02em;
    background: linear-gradient(90deg, #fff, #f5f5f5 60%, #ffd9b8);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }
  .navbar-user__info {
    display: none;
  }
  @media (min-width: 700px) {
    .navbar-user__info {
      display: block;
    }
  }

  /* DROPDOWN */
  .dropdown {
    position: relative;
  }
  .dropdown-menu {
    position: absolute;
    right: 0;
    top: calc(100% + 8px);
    min-width: 200px;
    background: #121319;
    border: 1px solid #2a2b34;
    border-radius: 12px;
    box-shadow: var(--nav-shadow);
    padding: 6px;
    display: none;
  }
  .dropdown.is-open .dropdown-menu {
    display: block;
  }
  .dropdown-menu__item {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 10px;
    background: #181a20;
    color: var(--nav-text);
    border: 1px solid #23242c;
    border-radius: 10px;
    padding: 10px 12px;
    cursor: pointer;
    text-align: left;
  }
  .dropdown-menu__item:hover {
    border-color: var(--accent);
    background: #1c1f26;
  }
  .dropdown-menu__icon {
    color: var(--accent-2);
    font-size: 18px;
  }

  /* MOBILE: search becomes overlay; shrink inline box */
  @media (max-width: 900px) {
    .navbar-wrapper {
      grid-template-columns: auto 1fr auto;
    }
    .navbar-search {
      min-width: 220px;
    }
  }
  @media (max-width: 640px) {
    .navbar-search {
      position: fixed;
      left: 12px;
      right: 12px;
      top: 10px;
      z-index: 1200;
      min-width: 0;
      display: none;
    }
    .navbar-search.is-open {
      display: flex;
    }
    #navbar_search_result_area {
      position: fixed;
      left: 12px;
      right: 12px;
      top: 58px;
    }
  }
</style>

<script>
  (function () {
    // --- Elements
    var body = document.body;

    var searchForm = document.querySelector(".navbar-search");
    var searchOpenBtn = document.querySelector(".navbar-search__btn-open");
    var searchCloseBtn = document.querySelector(".navbar-search__close");
    var searchField = document.getElementById("navbar-search__field");
    var resultArea = document.getElementById("navbar_search_result_area");

    var fullscreenBtn = document.querySelector(".fullscreen-btn");

    var dropdown = document.querySelector(".dropdown");
    var dropdownToggle = dropdown
      ? dropdown.querySelector(".dropdown__toggle")
      : null;

    // --- Search open/close
    function openSearch() {
      if (!searchForm) return;
      if (window.matchMedia("(max-width: 640px)").matches) {
        searchForm.classList.add("is-open");
      }
      searchField && searchField.focus();
    }
    function closeSearch() {
      if (!searchForm) return;
      searchForm.classList.remove("is-open");
      resultArea && (resultArea.style.display = "none");
      if (searchField) searchField.value = "";
    }

    if (searchOpenBtn) searchOpenBtn.addEventListener("click", openSearch);
    if (searchCloseBtn) searchCloseBtn.addEventListener("click", closeSearch);

    // Demo result toggle (replace with your fetch)
    if (searchField) {
      searchField.addEventListener("input", function () {
        if (!resultArea) return;
        var q = searchField.value.trim();
        resultArea.style.display = q ? "block" : "none";
      });
    }

    // --- Fullscreen
    function openFullscreen() {
      var el = document.documentElement;
      if (el.requestFullscreen) el.requestFullscreen();
      else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if (el.msRequestFullscreen) el.msRequestFullscreen();
      body.classList.add("is-fullscreen");
    }
    function closeFullscreen() {
      if (document.exitFullscreen) document.exitFullscreen();
      else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      else if (document.msExitFullscreen) document.msExitFullscreen();
      body.classList.remove("is-fullscreen");
    }
    if (fullscreenBtn) {
      fullscreenBtn.addEventListener("click", function () {
        if (
          !document.fullscreenElement &&
          !document.webkitFullscreenElement &&
          !document.msFullscreenElement
        ) {
          openFullscreen();
        } else {
          closeFullscreen();
        }
      });
    }

    // --- Dropdown
    function closeAllDropdowns(evt) {
      if (!dropdown) return;
      if (!dropdown.contains(evt.target)) {
        dropdown.classList.remove("is-open");
        if (dropdownToggle)
          dropdownToggle.setAttribute("aria-expanded", "false");
      }
    }
    if (dropdownToggle) {
      dropdownToggle.addEventListener("click", function (e) {
        e.stopPropagation();
        var isOpen = dropdown.classList.toggle("is-open");
        dropdownToggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
      });
      document.addEventListener("click", closeAllDropdowns);
      window.addEventListener("blur", function () {
        dropdown.classList.remove("is-open");
      });
    }

    // expose for your existing icon onclick (optional)
    window.openFullscreen = openFullscreen;
    window.closeFullscreen = closeFullscreen;
  })();
</script>
